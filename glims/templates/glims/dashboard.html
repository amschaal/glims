{% load staticfiles %}
<!doctype html>
<html lang="en" ng-app="mainapp">
<head>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Dashboard</title>

  <link rel="stylesheet" href="/static/responsive/lib/bootstrap/css/bootstrap.css"/>

  <link rel="stylesheet" href="/static/responsive/lib/font-awesome/css/font-awesome.css"/>
  <link rel="stylesheet" href="/static/css/famfamfam/css/fam-icons.css"/>

  <link rel="stylesheet" href="/static/responsive/css/dashboard/dashboard.css"/>
  <link rel="stylesheet" href="/static/vendor/angular-remote-table/angular-remote-table.css"/>

  <!-- SCRIPTS -->
  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <!--  <script src="/static/responsive/lib/angular/angular.js"></script>-->
  <script src="{{ STATIC_URL }}django_js_utils.js"></script>
  <script src="{% url 'jsurls' %}"></script>
  <script src="/static/vendor/angular/angular.js"></script>
  <script src="/static/vendor/angular/angular-resource.min.js"></script>
  <script src="/static/responsive/lib/angular-cookies/angular-cookies.js"></script>
  <script src="/static/responsive/lib/angular-bootstrap/ui-bootstrap.js"></script>
  <script src="/static/responsive/lib/angular-bootstrap/ui-bootstrap-tpls.js"></script>
  <script src="/static/responsive/lib/angular-ui-router/angular-ui-router.js"></script>
  <script src="/static/js/resources/models.js"></script>
  <script src="/static/vendor/angular-remote-table/angular-remote-table.js"></script>
  <script src="/static/js/directives/tasty-angular.js"></script>
  <script src="//cdn.jsdelivr.net/angular.initial-value/latest/angular-initial-value.min.js"></script>
  <!--  <script src="/static/responsive/js/dashboard.js"></script>-->
  <script>
  /*
  angular.module('Dashboard').config(['$httpProvider', function($httpProvider) {
	    $httpProvider.defaults.headers.common['X-CSRFToken'] = '{{ csrf_token|escapejs }}';
	}]);
  angular.module('Dashboard', ['ui.bootstrap', 'ui.router', 'ngCookies', 'ngResource', 'glimsModels','remoteTable']);
//'use strict';
angular.module('Dashboard').config(function($interpolateProvider) {
	  $interpolateProvider.startSymbol('{[');
	  $interpolateProvider.endSymbol(']}');
	});
angular.module('Dashboard').config(['$resourceProvider', function($resourceProvider) {
	  // Don't strip trailing slashes from calculated URLs
	  $resourceProvider.defaults.stripTrailingSlashes = false;
	}]);
  */
  function configureModule(module){
	  module.config(['$httpProvider', function($httpProvider) {
		    $httpProvider.defaults.headers.common['X-CSRFToken'] = '{{ csrf_token|escapejs }}';
		}]);
	  module.config(function($interpolateProvider) {
		  $interpolateProvider.startSymbol('{[');
		  $interpolateProvider.endSymbol(']}');
		});
	  module.config(['$resourceProvider', function($resourceProvider) {
		  // Don't strip trailing slashes from calculated URLs
		  $resourceProvider.defaults.stripTrailingSlashes = false;
		}]);
  }
  {% block angular_dependencies %}
  var dependencies =['ui.bootstrap', 'ui.router', 'ngCookies', 'ngResource', 'glimsModels','remoteTable','tastyAngular','initialValue'];
  {% endblock %}
  var mainapp = angular.module('mainapp', dependencies);
  mainapp.service('cartService', function($rootScope,$http) {
	  var samples = [];

	  var setSamples = function(data) {
		  console.log('set',data);
	      samples = data;
	      $rootScope.$broadcast('cart',data);
	  }

	  var getSamples = function(){
		  console.log('get',samples);
	      return samples;
	  }
	  var removeSamples = function(sample_ids){
			var url = django_js_utils.urls.resolve('remove_samples_from_cart');
			$http.post(url,{sample_ids:sample_ids})
			.success(function(data, status, headers, config) {
			   setSamples(data);
			}).error(function(){
			});
	  };
	  var addSamples = function(sample_ids){
			var url = django_js_utils.urls.resolve('add_samples_to_cart');
			$http.post(url,{sample_ids:sample_ids})
			.success(function(data, status, headers, config) {
				setSamples(data);
			}).error(function(){
			});
		};
	  return {
	    setSamples: setSamples,
	    getSamples: getSamples,
	    removeSamples: removeSamples,
	    addSamples: addSamples
	  };

	});
  configureModule(mainapp);
  </script>
  <script src="/static/js/resources/cart.js"></script>
  <!-- SCRIPTS -->

</head>
<body>
  <div id="page-wrapper" class="active">

    <!-- Sidebar -->

    <div id="sidebar-wrapper">
      <ul class="sidebar">
        <li class="sidebar-main">
          <a href="{% url 'home' %}">
            Dashboard
            <span class="menu-icon glyphicon glyphicon-transfer" ng-click="toggleSidebar()"></span>
          </a>
        </li>
        {% include 'glims/partials/sidebar.html' %}
      </ul>
      <div class="sidebar-footer">
        <div class="col-xs-8">
          <a href="http://genomecenter.ucdavis.edu">
            Genome Center
          </a>
        </div>
        <div class="col-xs-4">
          <a href="#" target="_blank">
            About
          </a>
        </div>
      </div>
    </div>

    <!-- End Sidebar -->

    <div id="content-wrapper">
      <div class="page-content">

        <!-- Header Bar -->

        <div class="row header">
          <div class="col-xs-12">
          {% if user.is_authenticated %}
            <div class="user pull-right">
              <div class="item dropdown">
                <a href="#" class="dropdown-toggle">
                  <img src="/static/responsive/img/avatar.jpg">
                </a>
                <ul class="dropdown-menu dropdown-menu-right">
                  <li class="dropdown-header">
                    {{user.first_name}} {{user.last_name}}
                  </li>
                  <li class="divider"></li>
                  <li class="link">
                    <a href="#">
                      Profile
                    </a>
                  </li>
                  <li class="divider"></li>
                  <li class="link">
                    <a href="{% url 'logout' %}?next=/">
                      Logout
                    </a>
                  </li>
                </ul>
              </div>
              <div class="item dropdown">
               <a href="#" class="dropdown-toggle">
                  <i class="fa fa-bell-o"></i>
                </a>
                <ul class="dropdown-menu dropdown-menu-right">
                  <li class="dropdown-header">
                    Notifications
                  </li>
                  <li class="divider"></li>
                  <li>
                    <a href="#">Server Down!</a>
                  </li>
                </ul>
              </div>
              <div class="item" ng-controller="CartMenuController" ng-init="init()">
               <a href="{% url 'cart' %}">
                  {[Utils.keys(samples).length]} <i class="fa fa-shopping-cart"></i>
                </a>
                
              </div>
            </div>
            

            
            <div class="meta">
              <div class="page">
                {% block page%}Dashboard{% endblock %}
              </div>
              <div class="breadcrumb-links">
                {% block breadcrumbs%}Home / Dashboard{% endblock %}
              </div>
            </div>
            
            <!-- 
            <div class="cart pull-right" ng-controller="CartController" ng-init="init()">
            {[Utils.keys(samples).length]}
            </div>
             -->
          </div>
          {% endif %}
        </div>

        <!-- End Header Bar -->

        <!-- Main Content -->
        {% block content %}
        <section data-ui-view></section>
        {% endblock %}
      </div><!-- End Page Content -->
    </div><!-- End Content Wrapper -->
  </div><!-- End Page Wrapper -->
</body>
</html>
