{% extends "glims/dashboard.html" %}
{% load crispy_forms_tags %}
{% block page %}Workflow{% endblock %}
{% block breadcrumbs %}<a href="{% url 'workflows' %}">Workflows</a> / {{workflow.name}} {% endblock %}
{% block content %}
<script src="/static/js/pages/workflow.js"></script>
<div class="row">
      <div class="col-lg-12">
        <div class="widget">
          <div class="widget-header">
            {{workflow.name}}
          </div>
          <div class="widget-body">
          	<h2>Workflow</h2>
          	<div ng-controller="WorkflowController" ng-init="init({workflow_id:{{workflow.id}}})">
	          {% crispy workflow_form workflow_form.helper %}
	          <alert ng-show="message" type="success" close="message=false;">{[message]}</alert>
	          <button ng-click="submit()" class="btn btn-default">Submit</button>
          	</div>
			<h2>Processes</h2>
			<div ng-controller="ProcessController">
			<accordion close-others="true">  
			{% for process in processes %}
				<accordion-group heading="{{process.process.type.name}}" is-open="{% if process.submitted%}true{%else%}false{%endif%}">
				<!-- <form method="POST" action="#process_{{process.process.id}}" id="process_{{process.process.id}}"> -->
				{% csrf_token %}
				<input type="hidden" name="process_id" value="{{process.process.id}}"/>
				{[{{process.form.prefix}}]}
	          	{{process.form|crispy}}
	          	<button class="btn btn-default" ng-click="submit({{process.process.id}},{{process.form.prefix}})">Submit</button>
	          	<!-- </form> -->
	          	</accordion-group>
	          	{% endfor %}
          	</accordion>
          	</div>
          </div>
        </div>
      </div>
{% endblock %}