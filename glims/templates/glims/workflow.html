{% extends "glims/dashboard.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block page %}Workflow{% endblock %}
{% block breadcrumbs %}<a href="{% url 'workflows' %}">Workflows</a> / {{workflow.name}} {% endblock %}
{% block content %}

<script src="/static/js/pages/workflow.js"></script>

<div class="row">
      <div class="col-lg-12">
        <div class="widget">
          <div class="widget-header">
            {{workflow.name}}
          </div>
          <div class="widget-body">
          	<h2>Workflow</h2>
          	<div ng-controller="WorkflowController" ng-init="init({workflow_id:{{workflow.id}}})">
	          <div angular-ajax-form url="{% url 'update_workflow' pk=workflow.id %}" prefix="workflow" on-error="onError" on-success="onSuccess">
	          {% crispy workflow_form workflow_form.helper %}
	          <button ng-click="submit(workflow)" class="btn btn-default">Submit</button>
	          </div>
          	</div>
			<h2>Processes</h2>
			<div ng-controller="ProcessController">
			<accordion close-others="true">  
			{% for process in processes %}
				<accordion-group heading="{{process.process.type.name}}" is-open="{% if process.submitted%}true{%else%}false{%endif%}">
				<!-- <form method="POST" action="#process_{{process.process.id}}" id="process_{{process.process.id}}"> -->
				{% csrf_token %}
				<input type="hidden" name="process_id" value="{{process.process.id}}"/>
				{[errors['{{process.process.id}}']]}
				<div angular-ajax-form url="{% url 'update_process' pk=process.process.id %}" prefix="{{process.form.prefix}}" on-error="onError" on-success="onSuccess">
	          	{% crispy process.form process.form.helper %}
	          	<button class="btn btn-default" ng-click="submit({{process.process.id}},'{{process.form.prefix}}',{{process.form.prefix}})">Submit</button>
				</div>
	          	<!-- </form> -->
	          	</accordion-group>
	          	{% endfor %}
          	</accordion>
          	</div>
          </div>
        </div>
      </div>
{% endblock %}